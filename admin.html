<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13abec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101c22",
                        "success-green": "#22c55e",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    }
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .nav-item.active {
            background-color: rgba(19, 171, 236, 0.1);
            color: #13abec;
            border-right: 3px solid #13abec;
        }

        .nav-item {
            border-right: 3px solid transparent;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white transition-colors duration-300">

    <div class="flex h-screen overflow-hidden">

        <!-- Sidebar -->
        <aside
            class="hidden md:flex flex-col w-64 bg-white dark:bg-[#1a282f] border-r border-slate-200 dark:border-slate-800">
            <div class="h-16 flex items-center px-6 border-b border-slate-200 dark:border-slate-800">
                <div
                    class="size-8 rounded bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white font-bold mr-3">
                    W</div>
                <span class="font-bold text-lg tracking-tight">Wallet Admin</span>
            </div>

            <nav class="flex-1 py-6 space-y-1">
                <button onclick="switchView('dashboard')" id="nav-dashboard"
                    class="nav-item active w-full flex items-center px-6 py-3 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">dashboard</span>
                    Dashboard
                </button>
                <button onclick="switchView('users')" id="nav-users"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">group</span>
                    User Management
                </button>
                <button onclick="switchView('p2p')" id="nav-p2p"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">currency_exchange</span>
                    P2P System
                </button>
                <button onclick="switchView('settings')" id="nav-settings"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">settings</span>
                    App Settings
                </button>
                <button onclick="switchView('deposits')" id="nav-deposits"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">payments</span>
                    Deposit Requests
                </button>
                <button onclick="switchView('withdrawals')" id="nav-withdrawals"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">money_off</span>
                    Withdrawals
                </button>
                <button onclick="switchView('support')" id="nav-support"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">support_agent</span>
                    Live Support
                </button>
            </nav>

            <div class="p-4 border-t border-slate-200 dark:border-slate-800">
                <div class="flex items-center gap-3">
                    <div class="size-9 rounded-full bg-slate-200 dark:bg-slate-700"></div>
                    <div>
                        <p class="text-sm font-bold">Admin User</p>
                        <p class="text-xs text-slate-500">Super Admin</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
            <!-- Mobile Header -->
            <header
                class="md:hidden flex items-center justify-between h-16 px-4 bg-white dark:bg-[#1a282f] border-b border-slate-200 dark:border-slate-800">
                <span class="font-bold text-lg">Admin Panel</span>
                <button class="p-2 -mr-2 text-slate-500">
                    <span class="material-symbols-outlined">menu</span>
                </button>
            </header>

            <main class="flex-1 overflow-y-auto p-4 md:p-8">

                <!-- VIEW: DASHBOARD -->
                <div id="view-dashboard" class="view-section">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Dashboard Overview</h1>
                        <p class="text-sm text-slate-500">Welcome back, here's what's happening today.</p>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400">Total Revenue</h3>
                                <span
                                    class="material-symbols-outlined text-green-500 bg-green-500/10 p-1.5 rounded-lg">attach_money</span>
                            </div>
                            <p class="text-2xl font-bold">$124,500.00</p>
                            <p class="text-xs text-green-500 flex items-center gap-1 mt-1 font-medium">
                                <span class="material-symbols-outlined text-[14px]">trending_up</span> +12.5% this month
                            </p>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400">Total Users</h3>
                                <span
                                    class="material-symbols-outlined text-primary bg-primary/10 p-1.5 rounded-lg">group</span>
                            </div>
                            <p class="text-2xl font-bold">8,240</p>
                            <p class="text-xs text-primary flex items-center gap-1 mt-1 font-medium">
                                <span class="material-symbols-outlined text-[14px]">arrow_upward</span> +140 this week
                            </p>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400">Active P2P Orders
                                </h3>
                                <span
                                    class="material-symbols-outlined text-orange-500 bg-orange-500/10 p-1.5 rounded-lg">swap_horiz</span>
                            </div>
                            <p class="text-2xl font-bold">1,492</p>
                            <p class="text-xs text-slate-500 flex items-center gap-1 mt-1 font-medium">
                                Volume: $450k
                            </p>
                        </div>
                    </div>
                </div>

                <!-- VIEW: SETTINGS -->
                <div id="view-settings" class="view-section hidden">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">App Settings</h1>
                        <p class="text-sm text-slate-500">Configure payment methods and limits.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Payment Methods -->
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <span class="material-symbols-outlined text-primary">account_balance_wallet</span>
                                Payment Accounts
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Bkash Number
                                        (Personal)</label>
                                    <input type="text" id="set-bkash-num" placeholder="01..."
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Nagad Number
                                        (Personal)</label>
                                    <input type="text" id="set-nagad-num" placeholder="01..."
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Binance Pay ID</label>
                                    <input type="text" id="set-binance-id" placeholder="123..."
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Limits -->
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <span class="material-symbols-outlined text-orange-500">tune</span>
                                Transaction Limits
                            </h3>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Bkash Min
                                            (BDT)</label>
                                        <input type="number" id="set-bkash-min" placeholder="10"
                                            class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm font-bold">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Nagad Min
                                            (BDT)</label>
                                        <input type="number" id="set-nagad-min" placeholder="10"
                                            class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm font-bold">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Binance Min (BDT)</label>
                                    <input type="number" id="set-binance-min" placeholder="0"
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm font-bold">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button onclick="saveSettings()"
                            class="bg-primary text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-[1.02] transition-transform">Save
                            All Changes</button>
                    </div>
                </div>

                <!-- VIEW: USERS -->
                <div id="view-users" class="view-section hidden">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                        <div>
                            <h1 class="text-2xl font-bold text-slate-900 dark:text-white">User Management</h1>
                            <p class="text-sm text-slate-500">Manage all registered users and their accounts.</p>
                        </div>
                        <div class="flex gap-2">
                            <input type="text" placeholder="Search user ID, email..."
                                class="bg-white dark:bg-[#1a282f] border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:ring-primary focus:border-primary">
                            <button
                                class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-primary/20 hover:bg-primary/90 transition-colors">Export
                                CSV</button>
                        </div>
                    </div>

                    <div
                        class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead
                                    class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 uppercase tracking-wider text-xs">
                                    <tr>
                                        <th class="px-6 py-3 font-semibold">User Info</th>
                                        <th class="px-6 py-3 font-semibold">KYC Status</th>
                                        <th class="px-6 py-3 font-semibold">Wallet Balance</th>
                                        <th class="px-6 py-3 font-semibold">Role</th>
                                        <th class="px-6 py-3 font-semibold text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-200 dark:divide-slate-800">
                                    <!-- User Row 1 -->
                                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div class="size-8 rounded-full bg-slate-200 bg-cover"
                                                    style="background-image: url('https://ui-avatars.com/api/?name=Munna+Dev&background=13abec&color=fff');">
                                                </div>
                                                <div>
                                                    <p class="font-medium text-slate-900 dark:text-white">Munna
                                                        Developer</p>
                                                    <p class="text-xs text-slate-500">ID: 8839201</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span
                                                class="inline-flex px-2 py-1 text-[10px] font-bold uppercase rounded-full bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-500">Verified</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <p class="font-medium">12,500.00 BDT</p>
                                            <p class="text-xs text-slate-500">≈ $12,500.00</p>
                                        </td>
                                        <td class="px-6 py-4">User</td>
                                        <td class="px-6 py-4 text-right">
                                            <button
                                                class="text-primary hover:bg-primary/10 p-1 rounded transition-colors"
                                                title="Edit"><span
                                                    class="material-symbols-outlined text-[18px]">edit</span></button>
                                            <button
                                                class="text-red-500 hover:bg-red-500/10 p-1 rounded transition-colors"
                                                title="Ban"><span
                                                    class="material-symbols-outlined text-[18px]">block</span></button>
                                        </td>
                                    </tr>
                                    <!-- User Row 2 -->
                                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div class="size-8 rounded-full bg-slate-200 bg-cover"
                                                    style="background-image: url('https://ui-avatars.com/api/?name=John+D&background=random');">
                                                </div>
                                                <div>
                                                    <p class="font-medium text-slate-900 dark:text-white">John Doe</p>
                                                    <p class="text-xs text-slate-500">ID: 1029384</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span
                                                class="inline-flex px-2 py-1 text-[10px] font-bold uppercase rounded-full bg-yellow-100 text-yellow-600 dark:bg-yellow-500/10 dark:text-yellow-500">Pending</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <p class="font-medium">450.00 BDT</p>
                                            <p class="text-xs text-slate-500">≈ $450.00</p>
                                        </td>
                                        <td class="px-6 py-4">User</td>
                                        <td class="px-6 py-4 text-right">
                                            <button
                                                class="text-primary hover:bg-primary/10 p-1 rounded transition-colors"><span
                                                    class="material-symbols-outlined text-[18px]">edit</span></button>
                                            <button
                                                class="text-red-500 hover:bg-red-500/10 p-1 rounded transition-colors"><span
                                                    class="material-symbols-outlined text-[18px]">block</span></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-3 border-t border-slate-200 dark:border-slate-800 flex justify-end">
                            <div class="flex gap-2">
                                <button
                                    class="px-3 py-1 text-sm border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors disabled:opacity-50">Previous</button>
                                <button
                                    class="px-3 py-1 text-sm border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors bg-slate-100 dark:bg-slate-800">1</button>
                                <button
                                    class="px-3 py-1 text-sm border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">2</button>
                                <button
                                    class="px-3 py-1 text-sm border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: DEPOSIT REQUESTS -->
                <div id="view-deposits" class="view-section hidden">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Deposit Requests</h1>
                        <p class="text-sm text-slate-500">Approve or reject manual deposit proofs.</p>
                    </div>

                    <div
                        class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead
                                    class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 uppercase tracking-wider text-xs">
                                    <tr>
                                        <th class="px-6 py-3">User</th>
                                        <th class="px-6 py-3">Amount</th>
                                        <th class="px-6 py-3">Method / Sender</th>
                                        <th class="px-6 py-3">Proof</th>
                                        <th class="px-6 py-3 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="deposits-table-body" class="divide-y divide-slate-200 dark:divide-slate-800">
                                    <!-- Injected -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

        </div>

        <!-- VIEW: WITHDRAWAL REQUESTS -->
        <div id="view-withdrawals" class="view-section hidden">
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Withdrawal Requests</h1>
                <p class="text-sm text-slate-500">Manage user withdrawal requests.</p>
            </div>

            <div
                class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead
                            class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 uppercase tracking-wider text-xs">
                            <tr>
                                <th class="px-6 py-3">User</th>
                                <th class="px-6 py-3">Amount</th>
                                <th class="px-6 py-3">Method</th>
                                <th class="px-6 py-3">Destination</th>
                                <th class="px-6 py-3 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawals-table-body" class="divide-y divide-slate-200 dark:divide-slate-800">
                            <!-- Injected -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- VIEW: P2P MANAGEMENT -->
        <div id="view-p2p" class="view-section hidden">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                <div>
                    <h1 class="text-2xl font-bold text-slate-900 dark:text-white">P2P Management</h1>
                    <p class="text-sm text-slate-500">Add and manage peer-to-peer trading advertisements.</p>
                </div>
                <button onclick="toggleP2PForm()"
                    class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-primary/20 hover:bg-primary/90 transition-colors flex items-center gap-2">
                    <span class="material-symbols-outlined">add</span>
                    Create Ad
                </button>
            </div>

            <!-- Add P2P Form -->
            <div id="p2p-form-container"
                class="hidden mb-8 bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm relative">
                <button onclick="toggleP2PForm()"
                    class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <h3 class="font-bold text-lg mb-4">Create New Advertisement</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Type</label>
                        <select
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                            <option value="buy">Buy (Merchant buys from user)</option>
                            <option value="sell">Sell (Merchant sells to user)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Asset</label>
                        <select
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                            <option value="BDT">BDT</option>
                            <option value="BTC">BTC</option>
                            <option value="ETH">ETH</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Price
                            (USD)</label>
                        <input type="number" step="0.01" placeholder="1.00"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Total
                            Amount</label>
                        <input type="number" step="1" placeholder="1000"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Min
                            Limit ($)</label>
                        <input type="number" placeholder="10"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Max
                            Limit ($)</label>
                        <input type="number" placeholder="500"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                </div>
                <div class="mt-6 flex justify-end">
                    <button onclick="saveAd()"
                        class="bg-success-green text-white px-6 py-2 rounded-lg text-sm font-bold shadow-lg shadow-success-green/20 hover:bg-success-green/90 transition-colors">
                        Publish Ad
                    </button>
                </div>
            </div>

            <!-- Active Orders -->
            <div
                class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                <table class="w-full text-left text-sm">
                    <thead
                        class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 uppercase tracking-wider text-xs">
                        <tr>
                            <th class="px-6 py-3 font-semibold">Type</th>
                            <th class="px-6 py-3 font-semibold">Price</th>
                            <th class="px-6 py-3 font-semibold">Limits</th>
                            <th class="px-6 py-3 font-semibold">Available</th>
                            <th class="px-6 py-3 font-semibold">Status</th>
                            <th class="px-6 py-3 font-semibold text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-200 dark:divide-slate-800">
                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                            <td class="px-6 py-4">
                                <span
                                    class="text-green-500 font-bold bg-green-500/10 px-2 py-0.5 rounded text-xs">BUY</span>
                                <span class="ml-2 font-medium">BDT</span>
                            </td>
                            <td class="px-6 py-4 font-bold">$1.02</td>
                            <td class="px-6 py-4 text-slate-500">$100 - $5,000</td>
                            <td class="px-6 py-4">4,520 BDT</td>
                            <td class="px-6 py-4">
                                <span class="inline-flex size-2 rounded-full bg-green-500"></span>
                                <span class="ml-2 text-xs">Online</span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <button class="text-slate-400 hover:text-red-500 transition-colors"><span
                                        class="material-symbols-outlined text-[18px]">delete</span></button>
                            </td>
                        </tr>
                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                            <td class="px-6 py-4">
                                <span
                                    class="text-red-500 font-bold bg-red-500/10 px-2 py-0.5 rounded text-xs">SELL</span>
                                <span class="ml-2 font-medium">BDT</span>
                            </td>
                            <td class="px-6 py-4 font-bold">$0.99</td>
                            <td class="px-6 py-4 text-slate-500">$50 - $1,000</td>
                            <td class="px-6 py-4">1,200 BDT</td>
                            <td class="px-6 py-4">
                                <span class="inline-flex size-2 rounded-full bg-slate-400"></span>
                                <span class="ml-2 text-xs">Offline</span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <button class="text-slate-400 hover:text-red-500 transition-colors"><span
                                        class="material-symbols-outlined text-[18px]">delete</span></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VIEW: LIVE SUPPORT -->
        <div id="view-support" class="view-section hidden h-full flex flex-col">
            <div class="mb-4">
                <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Live Support</h1>
                <p class="text-sm text-slate-500">Respond to user inquiries in real-time.</p>
            </div>

            <div
                class="flex-1 bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden flex">
                <!-- Chat List -->
                <div class="w-80 border-r border-slate-200 dark:border-slate-800 flex flex-col">
                    <div class="p-4 border-b border-slate-200 dark:border-slate-800">
                        <input type="text" placeholder="Search chats..."
                            class="w-full bg-slate-50 dark:bg-slate-800 border-none rounded-lg text-sm">
                    </div>
                    <div class="flex-1 overflow-y-auto">
                        <!-- Chat Item (Active) -->
                        <div
                            class="p-4 hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer bg-slate-50 dark:bg-slate-800/50 border-l-4 border-primary">
                            <div class="flex items-center justify-between mb-1">
                                <h4 class="font-bold text-sm text-slate-900 dark:text-white">Munna Developer
                                </h4>
                                <span class="text-[10px] text-slate-500">Just now</span>
                            </div>
                            <p class="text-xs text-slate-500 truncate">I have a question about my withdrawal.
                            </p>
                        </div>
                        <!-- Chat Item -->
                        <div class="p-4 hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer text-slate-500">
                            class="material-symbols-outlined">delete</span></button>
                            </td>
                            </tr>
                            </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- View: Bot Settings -->
                    <div id="view-support" class="view-section hidden space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-2xl font-bold text-slate-800 dark:text-white">AI Bot Settings
                                </h2>
                                <p class="text-slate-500">Configure auto-replies for the user chat.</p>
                            </div>
                        </div>

                        <!-- Add Rule Form -->
                        <div
                            class="bg-white dark:bg-[#1a282f] rounded-xl p-6 border border-slate-200 dark:border-slate-800 shadow-sm">
                            <h3 class="font-bold text-lg mb-4 text-slate-900 dark:text-white">Add New Rule</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Keyword
                                        (e.g. 'hello')</label>
                                    <input type="text" id="rule-keyword"
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2 text-slate-900 dark:text-white focus:outline-none focus:border-primary"
                                        placeholder="Enter keyword...">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Bot
                                        Reply</label>
                                    <div class="flex gap-2">
                                        <input type="text" id="rule-reply"
                                            class="flex-1 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2 text-slate-900 dark:text-white focus:outline-none focus:border-primary"
                                            placeholder="Enter the automated reply...">
                                        <button onclick="addBotRule()"
                                            class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg font-bold transition-all">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rules List -->
                        <div
                            class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                            <div class="p-6 border-b border-slate-200 dark:border-slate-800">
                                <h3 class="font-bold text-lg text-slate-900 dark:text-white">Active Rules</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-slate-500 uppercase bg-slate-50 dark:bg-slate-800/50">
                                        <tr>
                                            <th class="px-6 py-3">Keyword</th>
                                            <th class="px-6 py-3">Reply</th>
                                            <th class="px-6 py-3 text-right">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rules-table-body">
                                        <!-- Rules injected here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    </main>
                </div>
            </div>

            <script>
                function switchView(viewId) {
                    // Hide all views
                    document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));

                    // Show selected view
                    const view = document.getElementById(`view-${viewId}`);
                    if (view) view.classList.remove('hidden');

                    // Update Navigation State
                    document.querySelectorAll('.nav-item').forEach(el => {
                        el.classList.remove('active', 'text-primary');
                        el.classList.add('text-slate-500');
                    });

                    // Highlight active nav
                    const activeNav = document.getElementById(`nav-${viewId}`);
                    if (activeNav) {
                        activeNav.classList.add('active');
                        activeNav.classList.remove('text-slate-500');
                    }

                    if (viewId === 'support') {
                        renderRules();
                        startChatPolling();
                    } else {
                        stopChatPolling();
                    }

                    if (viewId === 'users') {
                        renderUsers();
                    }
                    if (viewId === 'deposits') {
                        renderDeposits();
                    }
                    if (viewId === 'withdrawals') {
                        renderWithdrawals();
                    }
                }

                function toggleP2PForm() {
                    const form = document.getElementById('p2p-form-container');
                    if (form.classList.contains('hidden')) {
                        form.classList.remove('hidden');
                    } else {
                        form.classList.add('hidden');
                    }
                }

                function saveAd() {
                    const type = document.querySelector('#p2p-form-container select:nth-of-type(1)').value;
                    const asset = document.querySelector('#p2p-form-container select:nth-of-type(2)').value;
                    const price = document.querySelector('#p2p-form-container input:nth-of-type(1)').value;
                    const total = document.querySelector('#p2p-form-container input:nth-of-type(2)').value;
                    const min = document.querySelector('#p2p-form-container input:nth-of-type(3)').value;
                    const max = document.querySelector('#p2p-form-container input:nth-of-type(4)').value;

                    if (!price || !total || !min || !max) {
                        alert('Please fill all fields');
                        return;
                    }

                    const ad = {
                        id: Date.now(),
                        type, asset, price, total, min, max,
                        available: total,
                        status: 'online'
                    };

                    const ads = JSON.parse(localStorage.getItem(P2P_KEY) || '[]');
                    ads.push(ad);
                    localStorage.setItem(P2P_KEY, JSON.stringify(ads));

                    alert('Ad Published!');
                    toggleP2PForm();
                    renderP2PAds();
                }

                function deleteAd(id) {
                    if (!confirm('Delete this ad?')) return;
                    let ads = JSON.parse(localStorage.getItem(P2P_KEY) || '[]');
                    ads = ads.filter(a => a.id != id);
                    localStorage.setItem(P2P_KEY, JSON.stringify(ads));
                    renderP2PAds();
                }

                /* --- User Management Logic --- */
                const USERS_STORAGE_KEY = 'wallet_users';

                function renderUsers() {
                    let users = [];
                    try {
                        users = JSON.parse(localStorage.getItem(USERS_STORAGE_KEY) || '[]');
                    } catch (e) { users = []; }

                    const tbody = document.querySelector('tbody');
                    if (!tbody) return;

                    if (users.length === 0) {
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-slate-500">
                            No users registered yet. Open the Wallet App to register a user.
                        </td>
                    </tr>
                `;
                        return;
                    }

                    tbody.innerHTML = users.map(u => `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="size-8 rounded-full bg-slate-200 bg-cover" style="background-image: url('${u.photo}');"></div>
                            <div>
                                <p class="font-medium text-slate-900 dark:text-white">${u.name}</p>
                                <p class="text-xs text-slate-500">ID: ${u.id}</p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="inline-flex px-2 py-1 text-[10px] font-bold uppercase rounded-full bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-500">${u.status}</span>
                    </td>
                    <td class="px-6 py-4">
                        <p class="font-medium">${u.balance.toFixed(2)} BDT</p>
                    </td>
                    <td class="px-6 py-4">User</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="deleteUser(${u.id})" class="text-red-500 hover:bg-red-500/10 p-1 rounded transition-colors" title="Delete"><span class="material-symbols-outlined text-[18px]">delete</span></button>
                    </td>
                </tr>
            `).join('');
                }

                /* --- Withdraw Logic --- */
                function renderWithdrawals() {
                    const trxs = JSON.parse(localStorage.getItem(TRX_STORAGE_KEY) || '[]');
                    const pending = trxs.filter(t => t.type === 'withdrawal' && t.status === 'pending');
                    const tbody = document.getElementById('withdrawals-table-body');

                    if (!tbody) return;

                    if (pending.length === 0) {
                        tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-slate-500">No pending withdrawal requests.</td></tr>`;
                        return;
                    }

                    tbody.innerHTML = pending.map(t => `
                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                            <td class="px-6 py-4">
                                <p class="font-medium text-slate-900 dark:text-white">${t.userName}</p>
                                <p class="text-xs text-slate-500">ID: ${t.userId}</p>
                            </td>
                            <td class="px-6 py-4 font-bold text-red-500">-${t.amount} BDT</td>
                            <td class="px-6 py-4 capitalize">${t.method}</td>
                            <td class="px-6 py-4 font-mono text-xs">${t.sender}</td>
                            <td class="px-6 py-4 text-right space-x-2">
                                <button onclick="updateWithdrawStatus('${t.id}', 'approved')" class="text-green-500 hover:bg-green-500/10 px-3 py-1 rounded text-xs font-bold transition-colors">Approve</button>
                                <button onclick="updateWithdrawStatus('${t.id}', 'rejected')" class="text-red-500 hover:bg-red-500/10 px-3 py-1 rounded text-xs font-bold transition-colors">Reject (Refund)</button>
                            </td>
                        </tr>
                    `).join('');
                }

                function updateWithdrawStatus(trxId, status) {
                    let trxs = JSON.parse(localStorage.getItem(TRX_STORAGE_KEY) || '[]');
                    const idx = trxs.findIndex(t => t.id === trxId);

                    if (idx === -1) return;

                    // Update Status
                    trxs[idx].status = status;
                    localStorage.setItem(TRX_STORAGE_KEY, JSON.stringify(trxs));

                    // Logic: If Rejected, Refund Balance
                    if (status === 'rejected') {
                        const userId = trxs[idx].userId;
                        const amount = trxs[idx].amount; // Refund this amount

                        let users = JSON.parse(localStorage.getItem(USERS_STORAGE_KEY) || '[]');
                        const uIdx = users.findIndex(u => u.id == userId);

                        if (uIdx !== -1) {
                            users[uIdx].balance += amount;
                            localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
                        }
                    }

                    alert(`Withdrawal ${status}!`);
                    renderWithdrawals();
                }

                /* --- Deposit Logic --- */
                const TRX_STORAGE_KEY = 'wallet_transactions';

                function renderDeposits() {
                    const trxs = JSON.parse(localStorage.getItem(TRX_STORAGE_KEY) || '[]');
                    const pending = trxs.filter(t => t.type === 'deposit' && t.status === 'pending');
                    const tbody = document.getElementById('deposits-table-body');

                    if (!tbody) return;

                    if (pending.length === 0) {
                        tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-slate-500">No pending deposits.</td></tr>`;
                        return;
                    }

                    tbody.innerHTML = pending.map(t => `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30">
                    <td class="px-6 py-4">
                        <p class="font-medium text-slate-900 dark:text-white">${t.userName}</p>
                        <p class="text-xs text-slate-500">ID: ${t.userId}</p>
                    </td>
                    <td class="px-6 py-4 font-bold text-green-500">+${t.amount} BDT</td>
                    <td class="px-6 py-4">
                        <p class="uppercase text-xs font-bold">${t.method}</p>
                        <p class="font-mono text-xs text-slate-500">${t.sender}</p>
                    </td>
                    <td class="px-6 py-4">
                        ${t.photo ? `<a href="${t.photo}" target="_blank" class="text-primary underline text-xs">View Photo</a>` : '<span class="text-slate-400 text-xs">No Photo</span>'}
                    </td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="approveDeposit('${t.id}')" class="bg-green-500 text-white px-3 py-1 rounded text-xs font-bold hover:bg-green-600 mr-2">Approve</button>
                        <button onclick="rejectDeposit('${t.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-xs font-bold hover:bg-red-600">Reject</button>
                    </td>
                </tr>
            `).join('');
                }

                function approveDeposit(trxId) {
                    if (!confirm('Approve this deposit? Funds will be added to user.')) return;

                    let trxs = JSON.parse(localStorage.getItem(TRX_STORAGE_KEY) || '[]');
                    const idx = trxs.findIndex(t => t.id === trxId);
                    if (idx === -1) return;

                    const trx = trxs[idx];
                    trx.status = 'approved';
                    trxs[idx] = trx;
                    localStorage.setItem(TRX_STORAGE_KEY, JSON.stringify(trxs));

                    // Update User Balance
                    let users = JSON.parse(localStorage.getItem(USERS_STORAGE_KEY) || '[]');
                    const uIdx = users.findIndex(u => u.id == trx.userId);
                    if (uIdx >= 0) {
                        users[uIdx].balance += trx.amount; // Add to Main
                        if (users[uIdx].balance_hold >= trx.amount) {
                            users[uIdx].balance_hold -= trx.amount; // Release from Hold
                        } else {
                            users[uIdx].balance_hold = 0;
                        }
                        localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
                    }

                    renderDeposits();
                    alert('Deposit Approved!');
                }

                function rejectDeposit(trxId) {
                    if (!confirm('Reject this deposit?')) return;
                    let trxs = JSON.parse(localStorage.getItem(TRX_STORAGE_KEY) || '[]');
                    const idx = trxs.findIndex(t => t.id === trxId);
                    if (idx === -1) return;

                    trxs[idx].status = 'rejected';
                    localStorage.setItem(TRX_STORAGE_KEY, JSON.stringify(trxs));
                    renderDeposits();
                }


                /* --- Settings Logic --- */
                const SETTINGS_KEY = 'wallet_settings';

                function loadSettings() {
                    const defaults = {
                        bkashNum: '01609434652',
                        nagadNum: '01625199589',
                        binanceId: '763666850',
                        bkashMin: 10,
                        nagadMin: 10,
                        binanceMin: 0
                    };
                    const settings = JSON.parse(localStorage.getItem(SETTINGS_KEY)) || defaults;

                    document.getElementById('set-bkash-num').value = settings.bkashNum || '';
                    document.getElementById('set-nagad-num').value = settings.nagadNum || '';
                    document.getElementById('set-binance-id').value = settings.binanceId || '';

                    document.getElementById('set-bkash-min').value = settings.bkashMin;
                    document.getElementById('set-nagad-min').value = settings.nagadMin;
                    document.getElementById('set-binance-min').value = settings.binanceMin;
                }

                function saveSettings() {
                    const settings = {
                        bkashNum: document.getElementById('set-bkash-num').value,
                        nagadNum: document.getElementById('set-nagad-num').value,
                        binanceId: document.getElementById('set-binance-id').value,
                        bkashMin: parseFloat(document.getElementById('set-bkash-min').value) || 0,
                        nagadMin: parseFloat(document.getElementById('set-nagad-min').value) || 0,
                        binanceMin: parseFloat(document.getElementById('set-binance-min').value) || 0
                    };

                    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
                    alert('Settings Saved Successfully!');
                }

                /* --- P2P Logic --- */
                const P2P_KEY = 'wallet_p2p_ads';

                function renderP2PAds() {
                    const ads = JSON.parse(localStorage.getItem(P2P_KEY) || '[]');
                    const tbody = document.querySelector('#view-p2p tbody');
                    if (!tbody) return;

                    if (ads.length === 0) {
                        tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-8 text-center text-slate-500">No active advertisements.</td></tr>`;
                        return;
                    }

                    tbody.innerHTML = ads.map(ad => `
                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                            <td class="px-6 py-4">
                                <span class="${ad.type === 'buy' ? 'text-green-500 bg-green-500/10' : 'text-red-500 bg-red-500/10'} font-bold px-2 py-0.5 rounded text-xs uppercase">${ad.type}</span>
                                <span class="ml-2 font-medium">${ad.asset}</span>
                            </td>
                            <td class="px-6 py-4 font-bold">$${ad.price}</td>
                            <td class="px-6 py-4 text-slate-500">$${ad.min} - $${ad.max}</td>
                            <td class="px-6 py-4">${ad.available} ${ad.asset}</td>
                            <td class="px-6 py-4">
                                <span class="inline-flex size-2 rounded-full bg-green-500"></span>
                                <span class="ml-2 text-xs">Online</span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <button onclick="deleteAd(${ad.id})" class="text-slate-400 hover:text-red-500 transition-colors"><span class="material-symbols-outlined text-[18px]">delete</span></button>
                            </td>
                        </tr>
                    `).join('');
                }

                // Initialize Settings on Load
                window.addEventListener('DOMContentLoaded', loadSettings);

                function rejectDeposit(trxId) {
                    if (!confirm('Reject this deposit?')) return;

                    let trxs = JSON.parse(localStorage.getItem(TRX_STORAGE_KEY) || '[]');
                    const idx = trxs.findIndex(t => t.id === trxId);
                    if (idx === -1) return;

                    const trx = trxs[idx];
                    trx.status = 'rejected';
                    trxs[idx] = trx;
                    localStorage.setItem(TRX_STORAGE_KEY, JSON.stringify(trxs));

                    // Remove from User Hold
                    let users = JSON.parse(localStorage.getItem(USERS_STORAGE_KEY) || '[]');
                    const uIdx = users.findIndex(u => u.id == trx.userId);
                    if (uIdx >= 0) {
                        if (users[uIdx].balance_hold >= trx.amount) {
                            users[uIdx].balance_hold -= trx.amount;
                        } else {
                            users[uIdx].balance_hold = 0;
                        }
                        localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
                    }

                    renderDeposits();
                }
                /* --- End Deposit Logic --- */

                function deleteUser(id) {
                    if (!confirm('Delete this user?')) return;
                    let users = JSON.parse(localStorage.getItem(USERS_STORAGE_KEY) || '[]');
                    users = users.filter(u => u.id !== id);
                    localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
                    renderUsers();
                }

                /* --- Bot Rules Logic --- */
                const RULES_STORAGE_KEY = 'bot_rules';

                function getRules() {
                    try {
                        return JSON.parse(localStorage.getItem(RULES_STORAGE_KEY) || '[]');
                    } catch { return []; }
                }

                function saveRules(rules) {
                    localStorage.setItem(RULES_STORAGE_KEY, JSON.stringify(rules));
                    renderRules();
                }

                function renderRules() {
                    const rules = getRules();
                    const tbody = document.getElementById('rules-table-body');
                    if (!tbody) return;

                    if (rules.length === 0) {
                        tbody.innerHTML = `<tr><td colspan="3" class="px-6 py-8 text-center text-slate-500">No auto-reply rules set. Add one above!</td></tr>`;
                        return;
                    }

                    tbody.innerHTML = rules.map((r, i) => `
                <tr class="border-b border-slate-100 dark:border-slate-800 last:border-0 hover:bg-slate-50 dark:hover:bg-slate-800/30">
                    <td class="px-6 py-4 font-mono text-primary">${r.keyword}</td>
                    <td class="px-6 py-4 text-slate-600 dark:text-slate-300">${r.reply}</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="deleteRule(${i})" class="text-red-500 hover:bg-red-50 text-xs font-bold uppercase px-3 py-1 rounded">Delete</button>
                    </td>
                </tr>
            `).join('');
                }

                function addBotRule() {
                    const keywordInput = document.getElementById('rule-keyword');
                    const replyInput = document.getElementById('rule-reply');

                    const keyword = keywordInput.value.trim().toLowerCase();
                    const reply = replyInput.value.trim();

                    if (!keyword || !reply) {
                        alert('Please enter both a keyword and a reply.');
                        return;
                    }

                    const rules = getRules();
                    rules.push({ keyword, reply });
                    saveRules(rules);

                    keywordInput.value = '';
                    replyInput.value = '';
                }

                function deleteRule(index) {
                    const rules = getRules();
                    rules.splice(index, 1);
                    saveRules(rules);
                }

                function forceReloadChat() {
                    renderAdminChat();
                    const btn = document.querySelector('button[title="Refresh Chat"]');
                    if (btn) {
                        btn.classList.add('animate-spin');
                        setTimeout(() => btn.classList.remove('animate-spin'), 500);
                    }
                }

                function formatTime(ms) {
                    const date = new Date(ms);
                    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                }

                // Listen for storage changes
                window.addEventListener('storage', (e) => {
                    if (e.key === CHAT_STORAGE_KEY) {
                        renderAdminChat();
                    }
                });

                function resetChat() {
                    if (confirm('Are you sure you want to clear all chat history? This cannot be undone.')) {
                        localStorage.removeItem(CHAT_STORAGE_KEY);
                        renderAdminChat();
                    }
                }

                // Initialize and Event Listeners
                document.addEventListener('DOMContentLoaded', () => {
                    const hash = window.location.hash.replace('#', '');
                    if (['dashboard', 'users', 'p2p', 'support'].includes(hash)) {
                        switchView(hash);
                    }

                    // Chat Input Enter Key
                    const chatInput = document.getElementById('admin-chat-input');
                    if (chatInput) {
                        chatInput.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' && !e.shiftKey) {
                                e.preventDefault();
                                sendAdminReply();
                            }
                        });
                    }

                    // Sync Status Check
                    setInterval(() => {
                        const statusDot = document.getElementById('sync-status-dot');
                        if (statusDot) {
                            statusDot.classList.toggle('opacity-50');
                        }
                    }, 2000);
                });
            </script>
</body>

</html>