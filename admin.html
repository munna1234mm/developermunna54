<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13abec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101c22",
                        "success-green": "#22c55e",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    }
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .nav-item.active {
            background-color: rgba(19, 171, 236, 0.1);
            color: #13abec;
            border-right: 3px solid #13abec;
        }

        .nav-item {
            border-right: 3px solid transparent;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white transition-colors duration-300">

    <div class="flex h-screen overflow-hidden">

        <!-- Sidebar -->
        <aside
            class="hidden md:flex flex-col w-64 bg-white dark:bg-[#1a282f] border-r border-slate-200 dark:border-slate-800">
            <div class="h-16 flex items-center px-6 border-b border-slate-200 dark:border-slate-800">
                <div
                    class="size-8 rounded bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white font-bold mr-3">
                    W</div>
                <span class="font-bold text-lg tracking-tight">Verified Buy & Sell Admin</span>
            </div>

            <nav class="flex-1 py-6 space-y-1">
                <button onclick="switchView('dashboard')" id="nav-dashboard"
                    class="nav-item active w-full flex items-center px-6 py-3 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">dashboard</span>
                    Dashboard
                </button>
                <button onclick="switchView('users')" id="nav-users"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">group</span>
                    User Management
                </button>
                <button onclick="switchView('p2p')" id="nav-p2p"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">currency_exchange</span>
                    P2P System
                </button>
                <button onclick="switchView('settings')" id="nav-settings"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">settings</span>
                    App Settings
                </button>
                <button onclick="switchView('deposits')" id="nav-deposits"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">payments</span>
                    Deposit Requests
                </button>
                <button onclick="switchView('withdrawals')" id="nav-withdrawals"
                    class="nav-item w-full flex items-center px-6 py-3 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white transition-colors text-left">
                    <span class="material-symbols-outlined mr-3">money_off</span>
                    Withdrawals
                </button>
            </nav>

            <div class="p-4 border-t border-slate-200 dark:border-slate-800">
                <div class="flex items-center gap-3">
                    <div class="size-9 rounded-full bg-slate-200 dark:bg-slate-700"></div>
                    <div>
                        <p class="text-sm font-bold">Admin User</p>
                        <p class="text-xs text-slate-500">Super Admin</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
            <!-- Mobile Header -->
            <header
                class="md:hidden flex items-center justify-between h-16 px-4 bg-white dark:bg-[#1a282f] border-b border-slate-200 dark:border-slate-800">
                <span class="font-bold text-lg">Admin Panel</span>
                <button class="p-2 -mr-2 text-slate-500">
                    <span class="material-symbols-outlined">menu</span>
                </button>
            </header>

            <main class="flex-1 overflow-y-auto p-4 md:p-8">

                <!-- VIEW: DASHBOARD -->
                <div id="view-dashboard" class="view-section">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Dashboard Overview</h1>
                        <p class="text-sm text-slate-500">Welcome back, here's what's happening today.</p>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400">Total Collection</h3>
                                <span
                                    class="material-symbols-outlined text-green-500 bg-green-500/10 p-1.5 rounded-lg">payments</span>
                            </div>
                            <p id="dash-total-collection" class="text-2xl font-bold">0.00 BDT</p>
                            <p class="text-xs text-slate-500 flex items-center gap-1 mt-1 font-medium">
                                Total approved deposits
                            </p>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400">Total Users</h3>
                                <span
                                    class="material-symbols-outlined text-primary bg-primary/10 p-1.5 rounded-lg">group</span>
                            </div>
                            <p id="dash-total-users" class="text-2xl font-bold">0</p>
                            <p class="text-xs text-slate-500 flex items-center gap-1 mt-1 font-medium">
                                Registered members
                            </p>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400">Pending Requests</h3>
                                <span
                                    class="material-symbols-outlined text-orange-500 bg-orange-500/10 p-1.5 rounded-lg">pending_actions</span>
                            </div>
                            <p id="dash-pending-reqs" class="text-2xl font-bold">0</p>
                            <p class="text-xs text-slate-500 flex items-center gap-1 mt-1 font-medium">
                                Needs your attention
                            </p>
                        </div>
                    </div>
                </div>

                <!-- VIEW: SETTINGS -->
                <div id="view-settings" class="view-section hidden">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">App Settings</h1>
                        <p class="text-sm text-slate-500">Configure payment methods and limits.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Payment Methods -->
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <span class="material-symbols-outlined text-primary">account_balance_wallet</span>
                                Payment Accounts
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Bkash Number
                                        (Personal)</label>
                                    <input type="text" id="set-bkash-num" placeholder="01..."
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Nagad Number
                                        (Personal)</label>
                                    <input type="text" id="set-nagad-num" placeholder="01..."
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Binance Pay ID</label>
                                    <input type="text" id="set-binance-id" placeholder="123..."
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Limits -->
                        <div
                            class="bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <span class="material-symbols-outlined text-orange-500">tune</span>
                                Transaction Limits
                            </h3>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Bkash Min
                                            (BDT)</label>
                                        <input type="number" id="set-bkash-min" placeholder="10"
                                            class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm font-bold">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Nagad Min
                                            (BDT)</label>
                                        <input type="number" id="set-nagad-min" placeholder="10"
                                            class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm font-bold">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Binance Min (BDT)</label>
                                    <input type="number" id="set-binance-min" placeholder="0"
                                        class="w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg p-2 text-sm font-bold">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button onclick="saveSettings()"
                            class="bg-primary text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-[1.02] transition-transform">Save
                            All Changes</button>
                    </div>
                </div>

                <!-- VIEW: USERS -->
                <div id="view-users" class="view-section hidden">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                        <div>
                            <h1 class="text-2xl font-bold text-slate-900 dark:text-white">User Management</h1>
                            <p class="text-sm text-slate-500">Manage all registered users and their accounts.</p>
                        </div>
                        <div class="flex gap-2">
                            <input type="text" placeholder="Search user ID, email..."
                                class="bg-white dark:bg-[#1a282f] border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:ring-primary focus:border-primary">
                            <button
                                class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-primary/20 hover:bg-primary/90 transition-colors">Export
                                CSV</button>
                        </div>
                    </div>

                    <div
                        class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead
                                    class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 uppercase tracking-wider text-xs">
                                    <tr>
                                        <th class="px-6 py-3 font-semibold">User Info</th>
                                        <th class="px-6 py-3 font-semibold">KYC Status</th>
                                        <th class="px-6 py-3 font-semibold">Wallet Balance</th>
                                        <th class="px-6 py-3 font-semibold">Role</th>
                                        <th class="px-6 py-3 font-semibold text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-200 dark:divide-slate-800">
                                    <!-- User Row 1 -->
                                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div class="size-8 rounded-full bg-slate-200 bg-cover"
                                                    style="background-image: url('https://ui-avatars.com/api/?name=Munna+Dev&background=13abec&color=fff');">
                                                </div>
                                                <div>
                                                    <p class="font-medium text-slate-900 dark:text-white">Munna
                                                        Developer</p>
                                                    <p class="text-xs text-slate-500">ID: 8839201</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span
                                                class="inline-flex px-2 py-1 text-[10px] font-bold uppercase rounded-full bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-500">Verified</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <p class="font-medium">12,500.00 BDT</p>
                                        </td>
                                        <td class="px-6 py-4">User</td>
                                        <td class="px-6 py-4 text-right">
                                            <button
                                                class="text-primary hover:bg-primary/10 p-1 rounded transition-colors"
                                                title="Edit"><span
                                                    class="material-symbols-outlined text-[18px]">edit</span></button>
                                            <button
                                                class="text-red-500 hover:bg-red-500/10 p-1 rounded transition-colors"
                                                title="Ban"><span
                                                    class="material-symbols-outlined text-[18px]">block</span></button>
                                        </td>
                                    </tr>
                                    <!-- User Row 2 -->
                                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div class="size-8 rounded-full bg-slate-200 bg-cover"
                                                    style="background-image: url('https://ui-avatars.com/api/?name=John+D&background=random');">
                                                </div>
                                                <div>
                                                    <p class="font-medium text-slate-900 dark:text-white">John Doe</p>
                                                    <p class="text-xs text-slate-500">ID: 1029384</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span
                                                class="inline-flex px-2 py-1 text-[10px] font-bold uppercase rounded-full bg-yellow-100 text-yellow-600 dark:bg-yellow-500/10 dark:text-yellow-500">Pending</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <p class="font-medium">450.00 BDT</p>
                                        </td>
                                        <td class="px-6 py-4">User</td>
                                        <td class="px-6 py-4 text-right">
                                            <button
                                                class="text-primary hover:bg-primary/10 p-1 rounded transition-colors"><span
                                                    class="material-symbols-outlined text-[18px]">edit</span></button>
                                            <button
                                                class="text-red-500 hover:bg-red-500/10 p-1 rounded transition-colors"><span
                                                    class="material-symbols-outlined text-[18px]">block</span></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-3 border-t border-slate-200 dark:border-slate-800 flex justify-end">
                            <div class="flex gap-2">
                                <button
                                    class="px-3 py-1 text-sm border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors disabled:opacity-50">Previous</button>
                                <button
                                    class="px-3 py-1 text-sm border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors bg-slate-100 dark:bg-slate-800">1</button>
                                <button
                                    class="px-3 py-1 text-sm border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">2</button>
                                <button
                                    class="px-3 py-1 text-sm border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: DEPOSIT REQUESTS -->
                <div id="view-deposits" class="view-section hidden">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Deposit Requests</h1>
                        <p class="text-sm text-slate-500">Approve or reject manual deposit proofs.</p>
                    </div>

                    <div
                        class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead
                                    class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 uppercase tracking-wider text-xs">
                                    <tr>
                                        <th class="px-6 py-3">User</th>
                                        <th class="px-6 py-3">Amount</th>
                                        <th class="px-6 py-3">Method / Sender</th>
                                        <th class="px-6 py-3">Proof</th>
                                        <th class="px-6 py-3 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="deposits-table-body" class="divide-y divide-slate-200 dark:divide-slate-800">
                                    <!-- Injected -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

        </div>

        <!-- VIEW: WITHDRAWAL REQUESTS -->
        <div id="view-withdrawals" class="view-section hidden">
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Withdrawal Requests</h1>
                <p class="text-sm text-slate-500">Manage user withdrawal requests.</p>
            </div>

            <div
                class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead
                            class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 uppercase tracking-wider text-xs">
                            <tr>
                                <th class="px-6 py-3">User</th>
                                <th class="px-6 py-3">Amount</th>
                                <th class="px-6 py-3">Method</th>
                                <th class="px-6 py-3">Destination</th>
                                <th class="px-6 py-3 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawals-table-body" class="divide-y divide-slate-200 dark:divide-slate-800">
                            <!-- Injected -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- VIEW: P2P MANAGEMENT -->
        <div id="view-p2p" class="view-section hidden">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                <div>
                    <h1 class="text-2xl font-bold text-slate-900 dark:text-white">P2P Management</h1>
                    <p class="text-sm text-slate-500">Add and manage peer-to-peer trading advertisements.</p>
                </div>
                <button onclick="toggleP2PForm()"
                    class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-primary/20 hover:bg-primary/90 transition-colors flex items-center gap-2">
                    <span class="material-symbols-outlined">add</span>
                    Create Ad
                </button>
            </div>

            <!-- Add P2P Form -->
            <div id="p2p-form-container"
                class="hidden mb-8 bg-white dark:bg-[#1a282f] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm relative">
                <button onclick="toggleP2PForm()"
                    class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <h3 class="font-bold text-lg mb-4">Create New Advertisement</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Type</label>
                        <select id="p2p-type"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                            <option value="buy">Buy (Merchant buys from user)</option>
                            <option value="sell">Sell (Merchant sells to user)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Asset</label>
                        <select id="p2p-asset"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                            <option value="BDT">BDT</option>
                            <option value="Stars">Telegram Stars</option>
                            <option value="BTC">BTC</option>
                            <option value="ETH">ETH</option>
                        </select>
                    </div>
                    <div id="p2p-target-link-box" class="hidden">
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Target Post
                            Link (For Stars)</label>
                        <input id="p2p-target-link" type="text" placeholder="https://t.me/channel/123"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                    <div id="p2p-star-count-box" class="hidden">
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Target Star
                            Count</label>
                        <input id="p2p-star-count" type="number" step="1" placeholder="100"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Price
                            (BDT)</label>
                        <input id="p2p-price" type="number" step="0.01" placeholder="100.00"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Total
                            Amount</label>
                        <input id="p2p-amount" type="number" step="1" placeholder="1000"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Min
                            Limit (BDT)</label>
                        <input id="p2p-min" type="number" placeholder="100"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Max
                            Limit (BDT)</label>
                        <input id="p2p-max" type="number" placeholder="5000"
                            class="w-full bg-slate-50 dark:bg-slate-800 border-slate-300 dark:border-slate-700 rounded-lg text-sm">
                    </div>
                </div>
                <div class="mt-6 flex justify-end">
                    <button onclick="saveAd()"
                        class="bg-success-green text-white px-6 py-2 rounded-lg text-sm font-bold shadow-lg shadow-success-green/20 hover:bg-success-green/90 transition-colors">
                        Publish Ad
                    </button>
                </div>
            </div>

            <!-- Active Orders -->
            <div
                class="bg-white dark:bg-[#1a282f] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                <table class="w-full text-left text-sm">
                    <thead
                        class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 uppercase tracking-wider text-xs">
                        <tr>
                            <th class="px-6 py-3 font-semibold">Type</th>
                            <th class="px-6 py-3 font-semibold">Price</th>
                            <th class="px-6 py-3 font-semibold">Limits</th>
                            <th class="px-6 py-3 font-semibold">Available</th>
                            <th class="px-6 py-3 font-semibold">Status</th>
                            <th class="px-6 py-3 font-semibold text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-200 dark:divide-slate-800">
                        <!-- Dynamic Ads Injected Here -->
                    </tbody>
                </table>
            </div>
        </div>



        </main>
    </div>
    </div>

    <!-- Photo Viewer Modal -->
    <div id="photo-modal"
        class="fixed inset-0 z-[10000] hidden flex items-center justify-center bg-black/80 p-4 animate-fade-in"
        onclick="closePhotoModal()">
        <div class="relative max-w-4xl w-full flex flex-col items-center">
            <button class="absolute -top-10 right-0 text-white hover:text-red-400 transition-colors">
                <span class="material-symbols-outlined text-4xl">close</span>
            </button>
            <img id="photo-modal-img" src="" class="max-w-full max-h-[85vh] rounded-lg shadow-2xl animate-scale-up"
                onclick="event.stopPropagation()">
        </div>
    </div>

    <script>
        /* --- Firebase Config & Init --- */
        const firebaseConfig = {
            apiKey: "AIzaSyBYvecq_HYeylhwCXaLot2A1U_9pvXMWXA",
            authDomain: "developerp2p.firebaseapp.com",
            projectId: "developerp2p",
            storageBucket: "developerp2p.firebasestorage.app",
            messagingSenderId: "85381141511",
            appId: "1:85381141511:web:76264b530079246e8246a2",
            measurementId: "G-882R3H9WMY"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        /* --- Node Names --- */
        const TRX_NODE = 'transactions';
        const USERS_NODE = 'users';
        const P2P_NODE = 'p2p_ads';
        const SETTINGS_NODE = 'settings';
        const RULES_NODE = 'bot_rules';

        let editingP2PId = null;

        /* --- Navigation --- */
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            const view = document.getElementById(`view-${viewId}`);
            if (view) view.classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active', 'text-primary');
                el.classList.add('text-slate-500');
            });

            const activeNav = document.getElementById(`nav-${viewId}`);
            if (activeNav) {
                activeNav.classList.add('active');
                activeNav.classList.remove('text-slate-500');
            }
        }

        /* --- P2P Logic --- */
        function toggleP2PForm() {
            const form = document.getElementById('p2p-form-container');
            form.classList.toggle('hidden');
            if (form.classList.contains('hidden')) {
                editingP2PId = null;
                document.getElementById('p2p-type').value = 'buy';
                document.getElementById('p2p-asset').value = 'BDT';
                document.getElementById('p2p-price').value = '';
                document.getElementById('p2p-amount').value = '';
                document.getElementById('p2p-min').value = '';
                document.getElementById('p2p-max').value = '';
                document.getElementById('p2p-target-link').value = '';
                document.getElementById('p2p-star-count').value = '';
                document.getElementById('p2p-target-link-box').classList.add('hidden');
                document.getElementById('p2p-star-count-box').classList.add('hidden');
            }
        }

        document.addEventListener('change', (e) => {
            if (e.target.id === 'p2p-asset') {
                const isStars = e.target.value === 'Stars';
                document.getElementById('p2p-target-link-box').classList.toggle('hidden', !isStars);
                document.getElementById('p2p-star-count-box').classList.toggle('hidden', !isStars);
            }
        });

        function saveAd() {
            const type = document.getElementById('p2p-type').value;
            const asset = document.getElementById('p2p-asset').value;
            const price = document.getElementById('p2p-price').value;
            const total = document.getElementById('p2p-amount').value;
            const min = document.getElementById('p2p-min').value;
            const max = document.getElementById('p2p-max').value;
            const targetLink = document.getElementById('p2p-target-link').value;
            const starCount = document.getElementById('p2p-star-count').value;

            if (!price || !total || !min || !max) {
                alert('Please fill all fields');
                return;
            }

            const adData = {
                type, asset, price, total, min, max,
                targetLink, starCount,
                available: total,
                status: 'online',
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            if (editingP2PId) {
                db.ref(`${P2P_NODE}/${editingP2PId}`).update(adData)
                    .then(() => { alert('Ad Updated!'); toggleP2PForm(); });
            } else {
                const newRef = db.ref(P2P_NODE).push();
                adData.id = newRef.key;
                newRef.set(adData)
                    .then(() => { alert('Ad Published!'); toggleP2PForm(); });
            }
        }

        function editAd(id) {
            db.ref(`${P2P_NODE}/${id}`).once('value', snapshot => {
                const ad = snapshot.val();
                if (!ad) return;
                editingP2PId = id;
                document.getElementById('p2p-type').value = ad.type;
                document.getElementById('p2p-asset').value = ad.asset;
                document.getElementById('p2p-price').value = ad.price;
                document.getElementById('p2p-amount').value = ad.total;
                document.getElementById('p2p-min').value = ad.min;
                document.getElementById('p2p-max').value = ad.max;
                document.getElementById('p2p-target-link').value = ad.targetLink || '';
                document.getElementById('p2p-star-count').value = ad.starCount || '';

                const isStars = ad.asset === 'Stars';
                document.getElementById('p2p-target-link-box').classList.toggle('hidden', !isStars);
                document.getElementById('p2p-star-count-box').classList.toggle('hidden', !isStars);

                document.getElementById('p2p-form-container').classList.remove('hidden');
                document.getElementById('p2p-form-container').scrollIntoView({ behavior: 'smooth' });
            });
        }

        function deleteAd(id) {
            if (!confirm('Delete this ad?')) return;
            db.ref(`${P2P_NODE}/${id}`).remove();
        }

        // Real-time P2P Ads Listener
        db.ref(P2P_NODE).on('value', snapshot => {
            const adsObj = snapshot.val() || {};
            const ads = Object.values(adsObj);
            renderP2PAds(ads);
        });

        function renderP2PAds(ads) {
            const tbody = document.querySelector('#view-p2p tbody');
            if (!tbody) return;

            if (ads.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-8 text-center text-slate-500">No active advertisements.</td></tr>`;
                return;
            }

            tbody.innerHTML = ads.map(ad => `
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                        <td class="px-6 py-4">
                            <span class="${ad.type === 'buy' ? 'text-green-500 bg-green-500/10' : 'text-red-500 bg-red-500/10'} font-bold px-2 py-0.5 rounded text-xs uppercase">${ad.type}</span>
                            <span class="ml-2 font-medium">${ad.asset}</span>
                        </td>
                        <td class="px-6 py-4 font-bold">${ad.price} BDT</td>
                        <td class="px-6 py-4 text-slate-500">${ad.min} - ${ad.max} BDT</td>
                        <td class="px-6 py-4">${ad.available} ${ad.asset}</td>
                        <td class="px-6 py-4">
                            <span class="inline-flex size-2 rounded-full bg-green-500"></span>
                            <span class="ml-2 text-xs">Online</span>
                        </td>
                        <td class="px-6 py-4 text-right space-x-2">
                            <button onclick="editAd('${ad.id}')" class="text-primary hover:bg-primary/10 p-1 rounded transition-colors"><span class="material-symbols-outlined text-[18px]">edit</span></button>
                            <button onclick="deleteAd('${ad.id}')" class="text-red-500 hover:bg-red-500/10 p-1 rounded transition-colors"><span class="material-symbols-outlined text-[18px]">delete</span></button>
                        </td>
                    </tr>
                `).join('');
        }

        /* --- User Logic --- */


        function renderUsers(users) {
            const tbody = document.querySelector('#view-users tbody');
            if (!tbody) return;

            if (users.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-slate-500">No users found.</td></tr>`;
                return;
            }

            tbody.innerHTML = users.map(u => `
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-3">
                                <div class="size-8 rounded-full bg-slate-200 bg-cover" style="background-image: url('${u.photo || ""} ');"></div>
                                <div>
                                    <p class="font-medium text-slate-900 dark:text-white">${u.name}</p>
                                    <p class="text-xs text-slate-500">ID: ${u.id}</p>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4"><span class="px-2 py-1 text-[10px] font-bold uppercase rounded-full bg-green-100 text-green-600">${u.status || 'Active'}</span></td>
                        <td class="px-6 py-4 font-medium">${(u.balance || 0).toFixed(2)} BDT</td>
                        <td class="px-6 py-4">User</td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="deleteUser('${u.id}')" class="text-red-500 hover:bg-red-500/10 p-1 rounded transition-colors"><span class="material-symbols-outlined text-[18px]">delete</span></button>
                        </td>
                    </tr>
                `).join('');
        }

        function deleteUser(id) {
            if (!confirm('Delete user?')) return;
            db.ref(`${USERS_NODE}/${id}`).remove();
        }

        /* --- Transaction Logic --- */
        db.ref(TRX_NODE).on('value', snapshot => {
            const trxsObj = snapshot.val() || {};
            const trxs = Object.values(trxsObj);
            renderDeposits(trxs);
            renderWithdrawals(trxs);
            updateDashboard(trxs, null);
        });

        db.ref(USERS_NODE).on('value', snapshot => {
            const usersObj = snapshot.val() || {};
            const users = Object.values(usersObj);
            renderUsers(users);
            updateDashboard(null, users);
        });

        function updateDashboard(trxs, users) {
            if (trxs) {
                const approved = trxs.filter(t => t.status === 'approved' && (t.type === 'deposit' || t.type === 'p2p_trade'));
                const totalCollection = approved.reduce((acc, t) => acc + (t.type === 'p2p_trade' ? (t.reward || 0) : (t.amount || 0)), 0);
                const pending = trxs.filter(t => t.status === 'pending').length;

                const colEl = document.getElementById('dash-total-collection');
                const penEl = document.getElementById('dash-pending-reqs');
                if (colEl) colEl.textContent = `${totalCollection.toFixed(2)} BDT`;
                if (penEl) penEl.textContent = pending;
            }
            if (users) {
                const userEl = document.getElementById('dash-total-users');
                if (userEl) userEl.textContent = users.length;
            }
        }

        function renderDeposits(trxs) {
            const pending = trxs.filter(t => (t.type === 'deposit' || t.type === 'p2p_trade') && t.status === 'pending');
            const tbody = document.getElementById('deposits-table-body');
            if (!tbody) return;

            if (pending.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-slate-500">No pending deposits.</td></tr>`;
                return;
            }

            tbody.innerHTML = pending.map(t => {
                const isStars = t.type === 'p2p_trade';
                const displayAmt = isStars ? `${t.reward.toFixed(2)} BDT (${t.amount} Stars)` : `${t.amount} BDT`;
                const methodInfo = isStars ? `<p class="uppercase text-xs font-bold text-primary">P2P: ${t.asset}</p><p class="text-[10px] text-slate-400 truncate max-w-[150px]">${t.sender}</p>` : `<p class="uppercase text-xs font-bold">${t.method}</p><p class="font-mono text-xs text-slate-500">${t.sender}</p>`;

                return `
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30">
                        <td class="px-6 py-4">
                            <p class="font-medium">${t.userName}</p>
                            <p class="text-xs text-slate-500">ID: ${t.userId}</p>
                        </td>
                        <td class="px-6 py-4 font-bold text-green-500">+${displayAmt}</td>
                        <td class="px-6 py-4">${methodInfo}</td>
                        <td class="px-6 py-4">${t.photo ? `<button onclick="viewPhoto('${t.photo}')" class="text-primary hover:underline text-xs font-bold flex items-center gap-1"><span class="material-symbols-outlined text-sm">image</span>View Proof</button>` : '<span class="text-slate-400 text-xs">No Proof</span>'}</td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="approveDeposit('${t.id}')" class="bg-green-500 text-white px-3 py-1 rounded text-xs font-bold mr-2">Approve</button>
                            <button onclick="rejectDeposit('${t.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-xs font-bold">Reject</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderWithdrawals(trxs) {
            const pending = trxs.filter(t => t.type === 'withdrawal' && t.status === 'pending');
            const tbody = document.getElementById('withdrawals-table-body');
            if (!tbody) return;

            if (pending.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-slate-500">No pending withdrawals.</td></tr>`;
                return;
            }

            tbody.innerHTML = pending.map(t => `
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                        <td class="px-6 py-4"><p class="font-medium">${t.userName}</p><p class="text-xs text-slate-500">ID: ${t.userId}</p></td>
                        <td class="px-6 py-4 font-bold text-red-500">-${t.amount} BDT</td>
                        <td class="px-6 py-4 capitalize">${t.method}</td>
                        <td class="px-6 py-4 font-mono text-xs">${t.sender}</td>
                        <td class="px-6 py-4 text-right space-x-2">
                            <button onclick="updateWithdrawStatus('${t.id}', 'approved')" class="text-green-500 font-bold text-xs uppercase">Approve</button>
                            <button onclick="updateWithdrawStatus('${t.id}', 'rejected')" class="text-red-500 font-bold text-xs uppercase">Reject</button>
                        </td>
                    </tr>
                `).join('');
        }

        function approveDeposit(trxId) {
            if (!confirm('Approve?')) return;
            db.ref(`${TRX_NODE}/${trxId}`).once('value', snapshot => {
                const trx = snapshot.val();
                if (!trx) return;

                db.ref(`${TRX_NODE}/${trxId}`).update({ status: 'approved' });
                db.ref(`${USERS_NODE}/${trx.userId}`).once('value', uSnap => {
                    const user = uSnap.val() || {};
                    const addAmt = trx.type === 'p2p_trade' ? (trx.reward || 0) : (trx.amount || 0);
                    const newBal = (user.balance || 0) + addAmt;
                    const newHold = Math.max(0, (user.balance_hold || 0) - (trx.type === 'deposit' ? trx.amount : 0));
                    db.ref(`${USERS_NODE}/${trx.userId}`).update({ balance: newBal, balance_hold: newHold });

                    // Referral Commission (1%)
                    if (user.referredBy) {
                        const commission = addAmt * 0.01;
                        db.ref(`${USERS_NODE}/${user.referredBy}/balance`).transaction(bal => (bal || 0) + commission);

                        // Push a mini transaction record for referral bonus
                        db.ref(TRX_NODE).push({
                            userId: user.referredBy,
                            userName: 'System',
                            type: 'referral_bonus',
                            amount: commission,
                            currency: 'BDT',
                            method: 'Referral',
                            status: 'approved',
                            sender: `Bonus from ${user.name}`,
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        });
                    }
                });
                alert('Approved!');
            });
        }

        function rejectDeposit(trxId) {
            if (!confirm('Reject?')) return;
            db.ref(`${TRX_NODE}/${trxId}`).once('value', snapshot => {
                const trx = snapshot.val();
                if (!trx) return;

                db.ref(`${TRX_NODE}/${trxId}`).update({ status: 'rejected' });
                db.ref(`${USERS_NODE}/${trx.userId}`).once('value', uSnap => {
                    const user = uSnap.val() || {};
                    const newHold = Math.max(0, (user.balance_hold || 0) - trx.amount);
                    db.ref(`${USERS_NODE}/${trx.userId}`).update({ balance_hold: newHold });
                });
            });
        }

        function updateWithdrawStatus(id, status) {
            if (!confirm(`${status}?`)) return;
            db.ref(`${TRX_NODE}/${id}`).once('value', snapshot => {
                const trx = snapshot.val();
                if (!trx) return;

                db.ref(`${TRX_NODE}/${id}`).update({ status: status });
                if (status === 'rejected') {
                    db.ref(`${USERS_NODE}/${trx.userId}`).once('value', uSnap => {
                        const user = uSnap.val() || {};
                        const newBal = (user.balance || 0) + trx.amount;
                        db.ref(`${USERS_NODE}/${trx.userId}`).update({ balance: newBal });
                    });
                }
                alert(`Withdrawal ${status}!`);
            });
        }

        /* --- Settings Logic --- */
        db.ref(SETTINGS_NODE).on('value', snapshot => {
            const settings = snapshot.val();
            if (settings) loadSettings(settings);
        });

        function loadSettings(settings) {
            document.getElementById('set-bkash-num').value = settings.bkashNum || '';
            document.getElementById('set-nagad-num').value = settings.nagadNum || '';
            document.getElementById('set-binance-id').value = settings.binanceId || '';
            document.getElementById('set-bkash-min').value = settings.bkashMin || 10;
            document.getElementById('set-nagad-min').value = settings.nagadMin || 10;
            document.getElementById('set-binance-min').value = settings.binanceMin || 0;
        }

        function saveSettings() {
            const settings = {
                bkashNum: document.getElementById('set-bkash-num').value,
                nagadNum: document.getElementById('set-nagad-num').value,
                binanceId: document.getElementById('set-binance-id').value,
                bkashMin: parseFloat(document.getElementById('set-bkash-min').value) || 0,
                nagadMin: parseFloat(document.getElementById('set-nagad-min').value) || 0,
                binanceMin: parseFloat(document.getElementById('set-binance-min').value) || 0
            };
            db.ref(SETTINGS_NODE).set(settings).then(() => alert('Settings Saved!'));
        }

        /* --- Bot Rules --- */
        db.ref(RULES_NODE).on('value', snapshot => {
            const rulesObj = snapshot.val() || {};
            const rules = Object.entries(rulesObj).map(([id, data]) => ({ id, ...data }));
            renderRules(rules);
        });

        function renderRules(rules) {
            const tbody = document.getElementById('rules-table-body');
            if (!tbody) return;
            tbody.innerHTML = rules.length === 0 ? `<tr><td colspan="3" class="px-6 py-8 text-center">No rules.</td></tr>` :
                rules.map(r => `<tr class="border-b last:border-0 hover:bg-slate-50"><td class="px-6 py-4 font-mono text-primary">${r.keyword}</td><td class="px-6 py-4 text-slate-600">${r.reply}</td><td class="px-6 py-4 text-right"><button onclick="deleteRule('${r.id}')" class="text-red-500 font-bold uppercase text-xs">Delete</button></td></tr>`).join('');
        }

        function addBotRule() {
            const k = document.getElementById('rule-keyword');
            const r = document.getElementById('rule-reply');
            if (!k.value || !r.value) return;
            db.ref(RULES_NODE).push({ keyword: k.value.trim().toLowerCase(), reply: r.value.trim() });
            k.value = ''; r.value = '';
        }

        function deleteRule(id) {
            db.ref(`${RULES_NODE}/${id}`).remove();
        }

        function viewPhoto(src) {
            const modal = document.getElementById('photo-modal');
            const img = document.getElementById('photo-modal-img');
            img.src = src;
            modal.classList.remove('hidden');
        }

        function closePhotoModal() {
            document.getElementById('photo-modal').classList.add('hidden');
        }

        /* --- Init --- */
        document.addEventListener('DOMContentLoaded', () => {
            const hash = window.location.hash.replace('#', '') || 'dashboard';
            const validViews = ['dashboard', 'users', 'p2p', 'settings', 'deposits', 'withdrawals', 'support'];
            switchView(validViews.includes(hash) ? hash : 'dashboard');

            setInterval(() => {
                const dot = document.getElementById('sync-status-dot');
                if (dot) dot.classList.toggle('opacity-50');
            }, 2000);
        });
    </script>
</body>

</html>